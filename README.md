# `wandb` self-hosted license generator

This repository contains a script to generate a self-hosted license for `wandb/local`.

## Pre-requisites
- Python 3.x
- Docker and Docker Compose
- Install requirements: `pip install -r requirements.txt`

## Usage
Run the script and answer the prompts
```python
python main.py
```

## How it works
`wandb/local` license is a signed, unencrypted JWT. The token will be verified in the docker container which exposes `jwks.json` unencrypted. This means that if we forge a `jwks.json` with our keys and mount it to the container, we can create any arbitrary license for use.\
Following is an example JWT and decrypted content generated by `deploy.wandb.ai` (signed with a generated private key and masked identifiable info):
```jwt
eyJhbGciOiJSUzI1NiIsImtpZCI6InUzaHgyQjQyQWhEUXM1M0xQY09yNnZhaTdoSlduYnF1bTRZTlZWd1VwSWM9In0.eyJjb25jdXJyZW50QWdlbnRzIjoxMCwidHJpYWwiOnRydWUsIm1heFN0b3JhZ2VHYiI6MTAwMCwibWF4VGVhbXMiOjEwLCJtYXhVc2VycyI6MTAwLCJtYXhSZWdpc3RlcmVkTW9kZWxzIjo1LCJleHBpcmVzQXQiOiJleHBpcmVzX21hc2tlZCIsImRlcGxveW1lbnRJZCI6InV1aWRfbWFza2VkIiwiZmxhZ3MiOlsiTk9USUZJQ0FUSU9OUyIsInNsYWNrIiwibm90aWZpY2F0aW9ucyIsIlNDQUxBQkxFIiwibXlzcWwiLCJzMyIsInJlZGlzIiwiTUFOQUdFTUVOVCIsIm9yZ19kYXNoIiwiYXV0aDAiXSwiYWNjZXNzS2V5IjoidXVpZF9tYXNrZWQiLCJzZWF0cyI6MTAwLCJ0ZWFtcyI6MTAsInJlZ2lzdGVyZWRNb2RlbHMiOjUsInN0b3JhZ2VHaWdzIjoxMDAwLCJleHAiOjk5OTk5OTk5OTl9.tGt0J2srtH4vPdd-lZBGAy79OHMJO585mVQS5e5mpsEdUk0_bunJjFeWcA6SaJItOoSEg8nScNtq_E689uo8APgmIgiMuD_KWOeUZkxfWRWK5pUrpkq15_AQd1vmdze4uT1s3jCUG9GHeUQlOAm5VmNRWVreTySwqAutFXhlj0bOk9STeK8VQvoRbFvkMLtVk0N1nhM6U4z7yNHejzDggV3HQ6FbGKWaafpjAJf_Vf95XEgerfhHrUwStWRNu-dE5BfdCZWADhf4gQNmRrSeeQrsW8N6lv_LDL1ZQ6JJU8qI7OgLwh-z4aLUK_2gaoCa2bI2yuY6amlvQsmRJuY9tw
```
```json
# Header
{
  "alg": "RS256",
  "kid": "u3hx2B42AhDQs53LPcOr6vai7hJWnbqum4YNVVwUpIc="
}
```
```json
# Payload
{
  "concurrentAgents": 10,
  "trial": true,
  "maxStorageGb": 1000,
  "maxTeams": 10,
  "maxUsers": 100,
  "maxRegisteredModels": 5,
  "expiresAt": "expires_masked",
  "deploymentId": "uuid_masked",
  "flags": [
    "NOTIFICATIONS",
    "slack",
    "notifications",
    "SCALABLE",
    "mysql",
    "s3",
    "redis",
    "MANAGEMENT",
    "org_dash",
    "auth0"
  ],
  "accessKey": "uuid_masked",
  "seats": 100,
  "teams": 10,
  "registeredModels": 5,
  "storageGigs": 1000,
  "exp": 9999999999
}
```

This script will generates a private key and a public key. The private key is used to sign the license and the public key will be converted to `jwks.json` for verification.

`docker-compose.yml` contains the docker container which mount `jwks.json` to `wandb` container and make the newly generated license valid.